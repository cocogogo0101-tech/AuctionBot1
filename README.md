# AuctionBot v2.0 Enhanced ğŸ¯

Ø¨ÙˆØª Ù…Ø²Ø§Ø¯Ø§Øª Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© ÙˆÙ†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠ.

Professional Discord Auction Bot with advanced features and automatic monitoring.

---

## âœ¨ Features / Ø§Ù„Ù…ÙŠØ²Ø§Øª

### Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:
- ğŸ¯ **Ù†Ø¸Ø§Ù… Ù…Ø²Ø§Ø¯Ø§Øª ÙƒØ§Ù…Ù„**: ÙØªØ­ØŒ Ø¥Ø¯Ø§Ø±Ø©ØŒ ÙˆØ¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ø¯Ø§Øª
- ğŸ’° **Ø£Ø²Ø±Ø§Ø± Ù…Ø²Ø§ÙŠØ¯Ø© Ø³Ø±ÙŠØ¹Ø©**: +1K, +100K, +500K + Ù…Ø²Ø§ÙŠØ¯Ø© Ù…Ø®ØµØµØ©
- â±ï¸ **Ø¹Ø¯ ØªÙ†Ø§Ø²Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ**: Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø· Ù„Ù…Ø¯Ø© 30 Ø«Ø§Ù†ÙŠØ©
- ğŸ”¥ **Ø±Ø³Ø§Ø¦Ù„ ØªØ±ÙˆÙŠØ¬ÙŠØ©**: Ù„ØªØ´Ø¬ÙŠØ¹ Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ®ØµÙŠØµ)
- ğŸ“Š **ØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©**: Ø³Ø¬Ù„ ÙƒØ§Ù…Ù„ Ù„ÙƒÙ„ Ù…Ø²Ø§Ø¯
- ğŸ¨ **Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ù…Ø®ØµØµØ©**: Ø¯Ø¹Ù… Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ± Ùˆ Unicode
- ğŸ”’ **Ù†Ø¸Ø§Ù… ØµÙ„Ø§Ø­ÙŠØ§Øª**: Ø±ØªØ¨ØŒ Ø£Ø³Ø±Ø§Ø±ØŒ ÙˆØµÙ„Ø§Ø­ÙŠØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
- ğŸ’¾ **Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø²Ø¯ÙˆØ¬Ø©**: PostgreSQL Ù…Ø¹ Ø§Ø­ØªÙŠØ§Ø·ÙŠ SQLite
- ğŸ› **Ø£ÙˆØ§Ù…Ø± Debug**: Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©
- âš¡ **Ø£Ø¯Ø§Ø¡ Ù…Ø­Ø³Ù‘Ù†**: Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø´Ø§Ù…Ù„Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

### English:
- ğŸ¯ **Complete auction system**: Open, manage, and end auctions
- ğŸ’° **Quick bid buttons**: +1K, +100K, +500K + custom bid
- â±ï¸ **Automatic countdown**: After 30 seconds of inactivity
- ğŸ”¥ **Promotional messages**: To encourage bidding (customizable)
- ğŸ“Š **Detailed reports**: Complete log for every auction
- ğŸ¨ **Custom emojis**: Server emoji & Unicode support
- ğŸ”’ **Permission system**: Roles, secrets, and multiple permissions
- ğŸ’¾ **Dual database**: PostgreSQL with SQLite fallback
- ğŸ› **Debug commands**: For diagnostics and status display
- âš¡ **Optimized performance**: Comprehensive error handling and auto-retry

---

## ğŸ“‹ Requirements / Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª

- Python 3.10 or higher
- Discord Bot Token
- (Optional) PostgreSQL database

---

## ğŸš€ Installation / Ø§Ù„ØªØ«Ø¨ÙŠØª

### 1. Clone the repository:
```bash
git clone <your-repo-url>
cd AuctionBot1
```

### 2. Install dependencies:
```bash
pip install -r requirements.txt
```

### 3. Create `.env` file:
```env
BOT_TOKEN=your_discord_bot_token_here

# Optional: PostgreSQL connection
DATABASE_URL=postgresql://user:password@host:port/database

# Optional: Bot configuration
DEFAULT_COMMISSION=20
DEFAULT_CURRENCY=Credits
COOLDOWN_SECONDS=2
DEBUG_MODE=False
```

### 4. Run the bot:
```bash
python bot.py
```

---

## âš™ï¸ Configuration / Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª

### Initial Setup Commands / Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©:

#### 1. Set server restriction:
```
/config_set_server
```
Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„Ø¨ÙˆØª Ø¨Ø§Ù„Ø¹Ù…Ù„ ÙÙŠÙ‡

#### 2. Set auction role:
```
/config_set_role role:@YourRole
```
Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…Ø²Ø§ÙŠØ¯Ø©

#### 3. Set channels:
```
/config_set_channels auction_channel:#auction log_channel:#logs
```
Ù„ØªØ­Ø¯ÙŠØ¯ Ù‚Ù†Ø§Ø© Ø§Ù„Ù…Ø²Ø§Ø¯ ÙˆÙ‚Ù†Ø§Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª

#### 4. Set commission & currency:
```
/config_set_misc commission:20 currency:Credits
```
Ù„ØªØ­Ø¯ÙŠØ¯ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¹Ù…ÙˆÙ„Ø© ÙˆØ§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„Ø©

#### 5. (Optional) Set secret code:
```
/config_set_secret secret:your_secret_code
```
Ù„ØªØ­Ø¯ÙŠØ¯ Ø±Ù…Ø² Ø³Ø±ÙŠ Ù„Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©

---

## ğŸ¯ Usage / Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…

### Opening an Auction / ÙØªØ­ Ù…Ø²Ø§Ø¯:

```
/auction_open start_bid:250k min_increment:50k duration_minutes:5
```

**Parameters:**
- `start_bid`: Starting bid amount (supports: 250k, 2.5m, 1000000)
- `min_increment`: Minimum bid increase
- `duration_minutes`: Auction duration (1-1440 minutes)
- `secret`: (Optional) Secret code if required

### Bidding / Ø§Ù„Ù…Ø²Ø§ÙŠØ¯Ø©:

Users can bid using the interactive panel buttons:
- **+1K**: Increase by 1,000
- **+100K**: Increase by 100,000
- **+500K**: Increase by 500,000
- **Custom**: Enter custom amount

### Managing Auctions / Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø²Ø§Ø¯Ø§Øª:

```
/auction_end          # Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ù…Ø²Ø§Ø¯ ÙŠØ¯ÙˆÙŠØ§Ù‹
/auction_undo_last    # Ø­Ø°Ù Ø¢Ø®Ø± Ù…Ø²Ø§ÙŠØ¯Ø©
```

---

## ğŸ› Debug Commands / Ø£ÙˆØ§Ù…Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ

### Check bot status:
```
/debug_status
```
Shows: uptime, database status, guild count, active auction

### Check auction details:
```
/debug_auction
```
Shows: detailed auction info, bids, timing, panel status

### Retry PostgreSQL:
```
/db_retry
```
Attempts to reconnect to PostgreSQL if using fallback

---

## ğŸ¨ Emoji Customization / ØªØ®ØµÙŠØµ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ

### Set custom emoji:
```
/emoji_set name:fire emoji:ğŸ”¥
/emoji_set name:custom emoji:<:customname:123456789>
```

### List all emojis:
```
/emoji_list
```

**Default Emojis:**
- `fire` ğŸ”¥
- `money` ğŸ’°
- `trophy` ğŸ†
- `celebrate` ğŸ‰
- `crown` ğŸ‘‘
- `rocket` ğŸš€
- And more...

---

## ğŸ“Š Database / Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### PostgreSQL (Recommended):
Set `DATABASE_URL` in `.env`:
```
DATABASE_URL=postgresql://user:password@host:port/database
```

### SQLite (Automatic Fallback):
If PostgreSQL connection fails, bot automatically uses local SQLite database (`local_db.sqlite`).

### Tables:
- `settings`: Bot configuration
- `auctions`: Auction records
- `bids`: Bid history

---

## ğŸ”’ Permissions / Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª

### Required Bot Permissions:
- Send Messages
- Embed Links
- Read Message History
- Add Reactions
- Manage Messages
- View Channel

### User Permissions:
1. **Auction Participant**: Needs assigned role
2. **Auction Manager**: Needs role OR admin permissions
3. **Configuration**: Needs "Manage Server" or "Manage Roles"

---

## ğŸ›¡ï¸ Security Features / Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø£Ù…Ø§Ù†

- âœ… Server restriction (single guild lock)
- âœ… Role-based access control
- âœ… Secret code protection
- âœ… Permission validation
- âœ… Rate limiting (cooldowns)
- âœ… Input validation & sanitization

---

## âš¡ Performance Optimizations / ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡

- Async/await throughout
- Connection pooling (PostgreSQL)
- WAL mode (SQLite)
- Emoji caching
- Automatic database fallback
- Retry logic with exponential backoff
- Panel update batching

---

## ğŸ”§ Troubleshooting / Ø­Ù„ Ø§Ù„Ù…Ø´Ø§ÙƒÙ„

### Problem: Bot not responding
**Solution:**
1. Check `/debug_status` for bot status
2. Verify bot has required permissions
3. Check console for errors

### Problem: Cannot open auction
**Solution:**
1. Verify role is configured: `/config_show`
2. Check channel permissions: `/debug_status`
3. Ensure no active auction exists

### Problem: Database connection issues
**Solution:**
1. Check `DATABASE_URL` format
2. Try `/db_retry` to reconnect
3. Bot will auto-fallback to SQLite

### Problem: Emojis not showing
**Solution:**
1. Verify emoji format: `<:name:id>` for server emojis
2. Check bot can access the emoji (same server or nitro)
3. Use `/emoji_list` to see configured emojis

---

## ğŸ“ Configuration File / Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª

All settings are stored in the database. View with:
```
/config_show
```

**Key Settings:**
- `server_id`: Restricted server ID
- `role_id`: Auction participant role
- `auction_channel_ids`: Comma-separated channel IDs
- `log_channel_id`: Log channel ID
- `commission`: Commission percentage
- `currency_name`: Display currency name
- `secret_code`: Admin secret code

---

## ğŸ”„ Update Guide / Ø¯Ù„ÙŠÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ«

### From Previous Version:

1. Backup your database:
```bash
# For SQLite
cp local_db.sqlite local_db.sqlite.backup

# For PostgreSQL
pg_dump yourdb > backup.sql
```

2. Replace all files except `.env`

3. Install new dependencies:
```bash
pip install -r requirements.txt --upgrade
```

4. Restart the bot:
```bash
python bot.py
```

5. Verify with `/debug_status`

---

## ğŸ“š API Reference / Ù…Ø±Ø¬Ø¹ API

### Main Functions:

**auctions.py:**
- `handle_bid()`: Process user bid
- `monitor_auction()`: Monitor auction activity
- `build_auction_embed()`: Create auction display
- `end_current_auction()`: Finalize auction

**database.py:**
- `init_db()`: Initialize connection
- `create_auction()`: Create new auction
- `add_bid()`: Record bid
- `get_active_auction()`: Get current auction

**security.py:**
- `has_auction_role()`: Check user role
- `check_bot_permissions()`: Verify permissions
- `can_open_auction()`: Validate auction opening

**bids.py:**
- `parse_amount()`: Parse bid strings
- `fmt_amount()`: Format display
- `validate_amount()`: Validate bid

---

## ğŸŒŸ Advanced Features / Ù…ÙŠØ²Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©

### Promotional System:
Customizable Arabic messages sent during inactivity to encourage bidding.

**Templates in `auctions.py`:**
```python
PROMO_TEMPLATES = [
    "{fire} **Ø²ÙŠØ¯ Ø£ÙƒØ«Ø± ÙˆÙˆÙ„Ø¹Ù‡Ø§!** {mention} Ø¯ÙØ¹ **{amount}**!",
    # Add your own templates...
]
```

### Countdown System:
3-second countdown before auction ends (after 30s inactivity).

### Automatic Monitoring:
Background tasks monitor auctions and trigger finalization automatically.

### Database Fallback:
Seamless switch between PostgreSQL and SQLite without data loss.

---

## ğŸ¤ Contributing / Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø©

Contributions welcome! Please:
1. Fork the repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Open Pull Request

---

## ğŸ“„ License / Ø§Ù„ØªØ±Ø®ÙŠØµ

[Specify your license here]

---

## ğŸ“ Support / Ø§Ù„Ø¯Ø¹Ù…

For issues or questions:
- Open an issue on GitHub
- Contact: [Your contact info]

---

## ğŸ‰ Credits / Ø§Ù„Ø´ÙƒØ±

Developed by [Your Name]

Special thanks to:
- discord.py community
- Contributors and testers

---

## ğŸ“‹ Changelog / Ø³Ø¬Ù„ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª

### v2.0 Enhanced (Current)
- âœ… Fixed missing imports (time, traceback)
- âœ… Fixed `auction_undo_last` command
- âœ… Added comprehensive error handling
- âœ… Added debug commands
- âœ… Added permission validation
- âœ… Improved database connection handling
- âœ… Enhanced emoji system with caching
- âœ… Better logging and monitoring
- âœ… Improved documentation

### v1.0 (Original)
- Basic auction functionality
- Button-based bidding
- Simple monitoring

---

## ğŸ”® Roadmap / Ø®Ø·Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„

- [ ] Anti-snipe feature (time extension)
- [ ] Multiple simultaneous auctions
- [ ] Bid history per user
- [ ] Statistics dashboard
- [ ] Web interface
- [ ] API endpoints
- [ ] Auction templates
- [ ] Scheduled auctions

---

**Made with â¤ï¸ for the Arabic Discord community**

**ØµÙÙ†Ø¹ Ø¨Ø­Ø¨ â¤ï¸ Ù„Ù…Ø¬ØªÙ…Ø¹ Ø¯ÙŠØ³ÙƒÙˆØ±Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ**
